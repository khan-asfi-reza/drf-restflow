[tox]
requires =
    tox>=4
    tox-uv>=1.16.3
env_list =
    py310
    py311
    py312
    py313
    py314
    py312-postgres
    py313-postgres
    lint
    coverage

[testenv]
runner = uv-venv-lock-runner
description = Run tests with {basepython}
package = wheel
wheel_build_env = .pkg
dependency_groups =
    test
commands =
    python runtests.py {posargs}



[testenv:py310]
basepython = python3.10

[testenv:py311]
basepython = python3.11

[testenv:py312]
basepython = python3.12

[testenv:py313]
basepython = python3.13

[testenv:py{312,313,314}-postgres]
description = Run tests with PostgreSQL on {basepython}
dependency_groups =
    {[testenv]dependency_groups}
    postgres
passenv =
    POSTGRES_DB_URL
setenv =
    POSTGRES_DB_URL = {env:POSTGRES_DB_URL:postgresql://postgres:postgres@localhost:5432/test_restflow}
commands =
    python runtests.py {posargs}

[testenv:lint]
description = Run code quality checks
skip_install = true
dependency_groups =
    lint
commands =
    ruff check restflow


[testenv:coverage-postgres]
# Coverage with PostgreSQL
description = Run tests with coverage on PostgreSQL
dependency_groups =
    {[testenv]dependency_groups}
    postgres
passenv =
    POSTGRES_DB_URL
setenv =
    POSTGRES_DB_URL = {env:POSTGRES_DB_URL:postgresql://postgres:postgres@localhost:5432/test_restflow}
commands =
    python runtests.py--coverage
    coverage report
    coverage html

[testenv:all]
description = Run all tests across all Python versions
dependency_groups =
    {[testenv]dependency_groups}
    postgres
passenv =
    POSTGRES_DB_URL
setenv =
    POSTGRES_DB_URL = {env:POSTGRES_DB_URL:postgresql://postgres:postgres@localhost:5432/test_restflow}
commands =
    python runtests.py {posargs}